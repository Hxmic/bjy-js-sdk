<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>回放</title>
    <link rel="stylesheet" href="http://live-cdn.baijiacloud.com/js-sdk/0.0.129/whiteboard/whiteboard.css">
    <link rel="stylesheet" href="http://live-cdn.baijiacloud.com/js-sdk/0.0.129/message/MessageList.css">
    <style>

        #whiteboard {
            width: 500px;
            height: 300px;
            background-color: #F0F0F0;
            overflow-y: auto;
            position: relative;
        }

        #message-list {
            border: 1px solid #ccc;
            width: 500px;
            height: 300px;
            position: relative;
        }

        .bjy-number {
            display: none !important;
        }

    </style>
</head>
<body>

    <div id="whiteboard">
        <div class="placeholder">

        </div>
    </div>

    <div id="message-list">
        <div class="placeholder">

        </div>
    </div>

    <video controls></video>

    <script src="http://cdn.bootcss.com/jquery/1.12.4/jquery.js"></script>
    <script src="http://live-cdn.baijiacloud.com/js-sdk/0.0.129/classroom/classroom.js"></script>
    <script src="http://live-cdn.baijiacloud.com/js-sdk/0.0.129/whiteboard/whiteboard.js"></script>
    <script src="http://live-cdn.baijiacloud.com/js-sdk/0.0.129/message/MessageList.js"></script>
    <script src="http://live-cdn.baijiacloud.com/js-sdk/0.0.129/playback/playback.js"></script>
    <script>

        var video = $('video')[0];
        video.onplaying = function () {
            BJY.playback.play();
        };
        video.onpause = function () {
            BJY.playback.pause();
        };
        video.onseeked = function () {
            BJY.playback.seek(video.currentTime);
        };

        var config = BJY.config;
        var eventEmitter = BJY.eventEmitter;

        BJY.playback.init({
            env: 'test',
            token: 'test12345678',
            class: {
                id: '17030937111088'
            },
            user: {
                number: '13147056',
                avatar: 'http://static.sunlands.com/newUserImagePath/13147056/40_40/13147056.jpg',
                name: '123123',
                type: 0
            }
        })
        .then(function (data) {

            BJY.whiteboard.init({
                element: $('#whiteboard .placeholder')
            });

            var userRoleMap = { };
            userRoleMap[ config.ROLE_TYPE_TEACHER ] = {
                en: 'teacher',
                cn: '老师'
            };
            userRoleMap[ config.ROLE_TYPE_ASSISTANT ] = {
                en: 'assistant',
                cn: '助教'
            };
            userRoleMap[ config.ROLE_TYPE_STUDENT ] = {
                en: 'student',
                cn: '学生'
            };
            userRoleMap[ config.ROLE_TYPE_GUEST ] = {
                en: 'guest',
                cn: '游客'
            };
            BJY.MessageList.create({
                element: $('#message-list .placeholder'),
                renderEmoji: function (name, url) {
                    return '<img ondragstart="return false" src="'
                            + (url + '@100w_1e_1l')
                            + '" srcset="'
                            + (url + '@200w_1e_1l')
                            + ' 2x">';
                },
                renderImage: function (url) {
                    if (BJY.isAlicloudImage(url)) {
                        return '<img ondragstart="return false" src="'
                            + (url + '@100w_1e_1l')
                            + '" srcset="'
                            + (url + '@200w_1e_1l')
                            + ' 2x">';
                    }
                    return '<img ondragstart="return false" src="' + url + '">';
                },
                renderUser: function (user, width, height) {
                    return {
                        id: user.id,
                        name: user.name,
                        number: user.number,
                        // 头像需压缩
                        avatar1x: BJY.compressImage({
                            url: user.avatar,
                            width: width,
                            height: height
                        }),
                        avatar2x: BJY.compressImage({
                            url: user.avatar,
                            width: width * 2,
                            height: height * 2
                        }),
                        // 根据用户类型，配置角色的英文和本地语言
                        role: userRoleMap[user.type].en,
                        localRole: userRoleMap[user.type].cn,
                    }
                }
            });

            BJY.playback.start();

            if (data.videos) {
                video.src = data.videos.low[0].url;
                video.play();
            }

        });

        eventEmitter
        .on(
            eventEmitter.DOC_IMAGE_LOAD_START,
            function () {
                console.log('翻页开始')
            }
        )
        .on(
            eventEmitter.CURRENT_DOC_IMAGE_LOAD_END,
            function () {
                console.log('翻页结束')
            }
        );

    </script>
</body>
</html>
