<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTML 播放器</title>
    <meta name="viewport" content="initial-scale=1.0,width=device-width,user-scalable=0,maximum-scale=1.0,minimum-scale=1.0">

    <style>
        video {
            width: 400px;
            height: 300px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <h1>
        PC 请用 Safari 打开
        手机请随意
    </h1>

    <p>
        播放器内部实现了响应对方的各种音视频切换，
        外部唯一需要做的只有两件事：

        <ul>
            <li>
                当对方打开音视频的任何一个时创建播放器
            </li>
            <li>
                当对方离开房间时销毁播放器
            </li>
        </ul>

        当对方尚未打开音视频，如果你认为空白不太好看，可以自定义样式，当对方打开音视频时，把播放器填充进去即可。

    </p>

    <div class="player">

    </div>

    <!-- 因为手机不支持自动播放，需在播放器位置放一个播放按钮，点击后调用 teacherPlayer.playAV(true) 触发播放 -->
    <button id="btn-play" class="hidden">
        播放
    </button>

    <script src="http://cdn.bootcss.com/jquery/1.12.4/jquery.js"></script>
    <script src="http://172.24.61.16:8858/output/0.0.216/classroom/classroom.js"></script>
    <script src="http://172.24.61.16:8858/output/0.0.216/player/player.js"></script>
    <script src="http://172.24.61.16:8858/output/0.0.216/player/core/Player.js"></script>
    <script src="http://172.24.61.16:8858/output/0.0.217/player/extension/html.js"></script>
    <script>

        BJY.init({
            // test 为百家云内测使用
            // 客户需配置为 production
            env: 'test',
            class: {
                // class id 需配置成开课的 id
                id: '17070445548808'
            },
            // 当前用户配置
            user: {
                // 为了避免互踢，number 配置为 0
                number: '0',
                avatar: 'http://img.gsxservice.com/30517_djgkb6i6.jpeg',
                name: '昵称',
                type: 0
            }
        });

        var store = BJY.store;
        var eventEmitter = BJY.eventEmitter;

        var Player = BJY.Player;

        var teacherPlayer;
        var playButton = $('#btn-play');

        playButton.on('click', function () {
            if (teacherPlayer.videoOn || teacherPlayer.audioOn) {
                teacherPlayer.playAVClose();
            }
            teacherPlayer.playAV(
                store.get('teacher.videoOn')
            );
        });

        eventEmitter
        .on(
            eventEmitter.TEACHER_MEDIA_ON,
            function () {
                if (!teacherPlayer) {
                    teacherPlayer = new Player({
                        element: $('.player'),
                        user: store.get('teacher'),
                        extension: Player.html
                    });
                    playButton.removeClass('hidden');
                }
            }
        )
        .on(
            eventEmitter.TEACHER_ADD,
            function () {
                console.log('老师进入教室');
            }
        )
        .on(
            eventEmitter.TEACHER_REMOVE,
            function () {
                console.log('老师离开教室');
                if (teacherPlayer) {
                    teacherPlayer.dispose();
                }
            }
        )


        .on(
            eventEmitter.HTML_VIDEO_LOAD_START,
            function () {
                console.log('正在加载视频');
            }
        )
        .on(
            eventEmitter.HTML_VIDEO_PLAY,
            function () {
                console.log('视频开始播放');
                playButton.addClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_VIDEO_PAUSE,
            function () {
                console.log('视频暂停');
                playButton.removeClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_VIDEO_LOAD_TIMEOUT,
            function () {
                console.log('视频加载超时');
                playButton.removeClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_VIDEO_LOAD_FAIL,
            function () {
                console.log('视频加载失败');
                playButton.removeClass('hidden');
            }
        )



        .on(
            eventEmitter.HTML_AUDIO_LOAD_START,
            function () {
                console.log('正在加载音频');
            }
        )
        .on(
            eventEmitter.HTML_AUDIO_PLAY,
            function () {
                console.log('音频开始播放');
                playButton.addClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_AUDIO_PAUSE,
            function () {
                console.log('音频暂停');
                playButton.removeClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_AUDIO_LOAD_TIMEOUT,
            function () {
                console.log('音频加载超时');
                playButton.removeClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_AUDIO_LOAD_FAIL,
            function () {
                console.log('音频加载失败');
                playButton.removeClass('hidden');
            }
        );

    </script>
</body>
</html>
