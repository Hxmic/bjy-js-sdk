<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTML 播放器</title>
    <meta name="viewport" content="initial-scale=1.0,width=device-width,user-scalable=0,maximum-scale=1.0,minimum-scale=1.0">

    <style>
        video {
            width: 400px;
            height: 300px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <h1>
        PC 请用 Safari 打开
        手机请随意
    </h1>

    <div class="player">

    </div>

    <!-- 因为手机不支持自动播放，需在播放器位置放一个播放按钮，点击后调用 teacherPlayer.playAV(true) 触发播放 -->
    <button id="btn-play" class="hidden">
        播放
    </button>

    <script src="http://cdn.bootcss.com/jquery/1.12.4/jquery.js"></script>
    <script src="http://live-cdn.baijiacloud.com/js-sdk/0.0.265/classroom/classroom.js"></script>
    <script src="http://live-cdn.baijiacloud.com/js-sdk/0.0.265/player/player.js"></script>
    <script src="http://live-cdn.baijiacloud.com/js-sdk/0.0.265/player/core/Player.js"></script>
    <script src="http://live-cdn.baijiacloud.com/js-sdk/0.0.265/player/extension/html.js"></script>
    <script>

        BJY.init({
            // test 为百家云内测使用
            // 客户需配置为 production
            env: 'test',
            class: {
                // class id 需配置成开课的 id
                id: '877449628',
                name: '课程名称',
                // 开始时间
                startTime: 1489104000000,
                // 结束时间
                endTime: 1489190400000
            },
            // 当前用户配置
            user: {
                // 为了避免互踢，number 配置为 0
                number: '0',
                avatar: 'http://img.gsxservice.com/30517_djgkb6i6.jpeg',
                name: '昵称',
                type: 0
            }
        });

        var store = BJY.store;
        var eventEmitter = BJY.eventEmitter;

        var Player = BJY.Player;

        var teacherPlayer;
        var playButton = $('#btn-play');

        playButton.on('click', function () {
            if (teacherPlayer.videoOn || teacherPlayer.audioOn) {
                teacherPlayer.playAVClose();
            }
            teacherPlayer.playAV(
                store.get('teacher.videoOn')
            );
        });

        eventEmitter
        .one(
            eventEmitter.VIEW_RENDER_TRIGGER,
            function (event, data) {

                // 此时教室只有你自己，需要请求才能知道别人的存在
                // 因此这里需要先请求当前发言用户
                // 老师也属于发言用户

                eventEmitter.trigger(
                    eventEmitter.USER_ACTIVE_REQ
                );

            }
        )
        // 老师播放器的生命周期管理
        .on(
            eventEmitter.TEACHER_MEDIA_ON,
            function () {
                if (!teacherPlayer) {
                    teacherPlayer = new Player({
                        element: $('.player'),
                        user: store.get('teacher'),
                        extension: Player.html
                    });
                    playButton.removeClass('hidden');
                }
            }
        )
        .on(
            eventEmitter.TEACHER_ADD,
            function () {
                console.log('老师进入教室');
            }
        )
        .on(
            eventEmitter.TEACHER_REMOVE,
            function () {
                console.log('老师离开教室');
                if (teacherPlayer) {
                    teacherPlayer.dispose();
                }
            }
        )


        .on(
            eventEmitter.HTML_VIDEO_LOAD_START,
            function () {
                console.log('正在加载视频');
            }
        )
        .on(
            eventEmitter.HTML_VIDEO_PLAY,
            function () {
                console.log('视频开始播放');
                playButton.addClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_VIDEO_PAUSE,
            function () {
                console.log('视频暂停');
                playButton.removeClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_VIDEO_LOAD_TIMEOUT,
            function () {
                console.log('视频加载超时');
                playButton.removeClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_VIDEO_LOAD_FAIL,
            function () {
                console.log('视频加载失败');
                playButton.removeClass('hidden');
            }
        )



        .on(
            eventEmitter.HTML_AUDIO_LOAD_START,
            function () {
                console.log('正在加载音频');
            }
        )
        .on(
            eventEmitter.HTML_AUDIO_PLAY,
            function () {
                console.log('音频开始播放');
                playButton.addClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_AUDIO_PAUSE,
            function () {
                console.log('音频暂停');
                playButton.removeClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_AUDIO_LOAD_TIMEOUT,
            function () {
                console.log('音频加载超时');
                playButton.removeClass('hidden');
            }
        )
        .on(
            eventEmitter.HTML_AUDIO_LOAD_FAIL,
            function () {
                console.log('音频加载失败');
                playButton.removeClass('hidden');
            }
        );

    </script>
</body>
</html>


